# baba simulator



### 题面

Masou最近迷上了一款《baba is you》的推箱子游戏，与传统推箱子不同的一点是，这个游戏由单词和物体两种东西构成，单词拼成一块能够产生语法，语法能够定义物体的属性。举例来说，当出现了“rock is push”这样的语法时，就说明石头(rock)具有了可以被推动(push)的属性。

每个关卡是一个有限的2D平面，玩家能操作的是被定义为"is you"属性的物体，玩家可以通过上下左右按键来控制该物体上下左右的移动。当"is you"属性的物体与"is win"属性的物体**接触**时算作通过关卡。

除了以上列举的词条，这个游戏还有很多其他的词条，具体而言可以总结成如下的表：

（形式化地，我们将类似“rock is push"语法左侧的"rock"一类词定义为主体词，”push“一类词定义为属性词；特别地，类似"rock is flag"两侧都是主体词，这时游戏将把所有物体"rock"变成物体"flag"；如果类似"rock is rock"，则是一种**强定义**，此时所有"rock is flag"等改变rock的语句全部无效化（描述rock的属性的语法不受影响）。）

| 名称   | 代号 | 词性   | 用途                                                   |
| ------ | ---- | ------ | ------------------------------------------------------ |
| is     | *    | is     | 连接两个词组成语法的桥梁                               |
| baba   | a    | 主体词 | 用于描述一种白色生物（一般由你操控）                   |
| flag   | b    | 主体词 | 用于描述旗子                                           |
| rock   | c    | 主体词 | 石头                                                   |
| wall   | d    | 主体词 | 墙                                                     |
| skull  | e    | 主体词 | 骷髅                                                   |
| water  | f    | 主体词 | 水                                                     |
| lava   | g    | 主体词 | 岩浆                                                   |
| ice    | h    | 主体词 | 冰                                                     |
| key    | i    | 主体词 | 钥匙                                                   |
| door   | j    | 主体词 | 门                                                     |
| you    | A    | 属性词 | 该物体被玩家操控（如果有多个you物体则会同时操控）      |
| win    | B    | 属性词 | is you的物体与其接触时通关                             |
| push   | C    | 属性词 | 该物体可以被推动（一排push物体可以一齐推动）           |
| stop   | D    | 属性词 | 该物体不能被跨越（不允许一个物体移动到stop物体位置上） |
| defeat | E    | 属性词 | is you的物体与其接触时前者消失                         |
| sink   | F    | 属性词 | **其他**物体与其接触时同一格的所有物体消失（包括自己） |
| hot    | G    | 属性词 | is melt的物体与其接触时前者消失                        |
| melt   | H    | 属性词 | 接触is hot的物体时消失                                 |
| open   | I    | 属性词 | 接触is shut的物体时两者消失(此时无视stop规则)          |
| shut   | J    | 属性词 | 接触is open的物体时两者消失(此时无视stop规则)          |

**tips:所有词条可以当作一种特殊的物体，且默认具有push属性。**

**tips2:"接触"指两个物体A和B处于同一个位置，注意没有特殊说明，A和B可以是一个物体。**

聪明的Masou把许多关卡的2D平面截了图，这样他不用登入游戏就可以看图云通关，为了保证自己步骤的正确性，他告诉了你他的操作序列（上下左右），请你帮忙验证如果输入这个序列，是否真的能通关。

具体而言，Masou会给你一张描述关卡图的n\*m矩阵，每个位置都有一个代号（见上表），对应游戏中的物体，保证初始图同一位置至多出现一个物体。另外，所有物体都只能待在n\*m的范围内。

下面的表描述了剩余的代号：

| 名称  | 代号 | 属性             |
| ----- | ---- | ---------------- |
| baba  | 0    | （物体）白色生物 |
| flag  | 1    | （物体）旗子     |
| rock  | 2    | （物体）石头     |
| wall  | 3    | （物体）墙       |
| skull | 4    | （物体）骷髅     |
| water | 5    | （物体）水       |
| lava  | 6    | （物体）岩浆     |
| ice   | 7    | （物体）冰       |
| key   | 8    | （物体）钥匙     |
| door  | 9    | （物体）门       |
| 空    | _    | 什么都没有       |

玩家的操作序列描述为：左(L),右(R),上(U),下(D)组成的字符串。

形式化地，设目前的关卡语法集合是S，游戏根据玩家操作运行的时间轴如下：

玩家进行操作$\Rightarrow$根据语法集S更新所有词条/物体的位置，存在状态$\Rightarrow$根据新词条更新语法集S，执行语法集S

对于执行语法部分，所有的语法**同时执行**。（如果 X is X 和 X is Y 同时存在，则 X is X 优先级更高）

关于游戏运作的具体逻辑可以参看下方的例子一栏。



### 输入

本题有多组数据。

第一行一个数T，表示数据组数。(T<=5)

对于每一组数据：

第一行三个数n,m,k,表示地图大小，操作序列长度(n<=40,m<=40,k<=150)；

后面n行每行一个长度为m的字符串用代号描述地图；

后面一行长度为k的字符串描述操作序列。

```
3
7 9 10
_i*A_d*D_
_c*C_b*B_
333333333
3_____2_3
38____213
3_____2_3
333333333
RRRRURLDDRUR
13 16 26
____a*A_________
____i*I_________
___f*33333333333
__c*C3____3____3
__*F_3_0__3__1_3
__G__3_2__3____3
_____35555377373
__d*D3____3____3
__*__3____3____3
h*H_b3_8__9__2_3
*___*3____3____3
E___B33333333333
_____j*Jj*D_____
DDDLDDRRRRRRDRURULDLUUUUUR
14 16 34
________________
________________
_________d*D____
___3333333333___
___3________3___
___3__d_____3___
___3_c*A____3___
___3__B_____3___
___3_____2__3___
___3________3___
___3333333333___
________________
________________
________________
LLLLURRRUULLULDLLUUULRURRRRDDRDLLL
```

### 输出

共T行，每行输出YES或NO，表示程序是否在执行操作序列的**某一步**通关。

```
YES
YES
YES
```



### 例子

下面拿样例输入的三个关卡作为例子：

![](pics\1.png)

翻译一下，你可以操纵钥匙，你要到达旗子才能通关，周围被墙围着出不去，石头可以被推动。

如果先推中间的石头，旗子会被石头压住，没法通关：

![](pics\2.png)

正确的解法是先右推两边的石头，再把中间石头往下推，这样就能到达旗子通关了：

![](pics\3.png)

来看第二个关卡（翻译略）：

![](pics\4.png)

正确过法是先把石头推入水，让baba通过；再推动钥匙让门打开；最后推石头把冰融化，到达旗子过关。注意这里石头不能融化墙，因为墙是stop的，因此不能接触（但钥匙能正常使用，因为open和shut判定条件无视stop规则的限制）。顺带一提，如果baba不推石头直接越过冰，会因为冰的defeat属性消失掉，导致无法通关。

![](pics\5.png)

对于第三个关卡，这里要用到一点技巧：

正常情况下由于墙是stop的，rock没办法与墙接触从而通关。

![](pics\6.png)

正确的通关方法为：先把win推到一边，再用wall把rock推开，这样就变成"wall is you"，再操纵墙把”wall is stop"语法破坏，破坏后把rock推开wall，变回"rock is you"，再拼出"wall is win"就可以接触墙通关了。

![](pics\7.png)

![](pics\8.png)

~~看来你已经学会怎么玩了，现在让我们来做几道题吧~~

